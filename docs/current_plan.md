# Текущие доработки (нерешённое)

## SQL
- [ ] Central ingest: оставить только `HC_MEASUREMENT_BATCH` (сейчас допускает event_type NULL). Уточнить типы событий и добавить жёсткую проверку, чтобы посторонние payload не попадали в `analytics_cr`.
- [ ] Заводы: пересчитать prev/last с учётом существующих замеров (история), а не только текущий батч; добавить строгие проверки порядка дат/толщин и транзакцию вокруг вставок/FDW.
- [ ] NOTIFY: кроме `events_ingest` нет сигналов про enqueue/requeue/cleanup — решить, нужны ли дополнительные каналы и зафиксировать в UI/CLI.

## Core
- [ ] Удалить или задействовать `MeasurementAnalyticsEntryViewModel` (не используется нигде).
- [ ] Добавить централизованный helper в Core для построения payload batch (аналог `MeasurementBatchHelper`), чтобы UI/CLI/Tests не разъезжались.

## Infrastructure
- [ ] Проверить логгер: `OilErp.Infrastructure/Util/AppLogger` публичный, UI подключает его через алиас — убедиться, что консольное дублирование устраивает (иначе параметризовать цели логирования).
- [ ] Добавить опцию отключения pg_proc-инспекции/кэша для диагностики (переключатель в конфиге).

## Tests
- [ ] Прогнать новые смоук-сценарии (`LoadSmokeTests`, `NegativeSmokeTests`, `ListenSmokeTests`) и оставить только устойчивые; дубли/старые сценарии удалить или пометить skipped.
- [ ] Для e2e plants добавить явную проверку, что события из ANPZ/KRNPZ после ingest действительно обновляют `analytics_cr` и очищают очередь.

## UI
- [ ] Добавить экран/секцию для очереди событий (peek/requeue/cleanup) и для оповещений `events_ingest` (отображение прогресса ingest).
- [ ] Диагностика LISTEN: авто-переподключение при падении слушателя, выбор каналов (events_ingest, custom).
- [ ] Согласовать единый источник конфигов в UI (OILERP__DB__CONN + plant) и показать пользователю активные строки/таймауты.
